<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Happy Holidays</title>

<!-- Open Graph metadata -->
<meta property="og:type" content="website">
<meta property="og:title" content="Happy Holidays">
<meta property="og:description" content="Wishing you health, happiness, and prosperity in 2026">
<meta property="og:image" content="https://martincking.github.io/ChristmasCard/Slide1.PNG">
<meta property="og:url" content="https://martincking.github.io/ChristmasCard/index.html">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: black;
}

.slideshow {
  position: relative;
  width: 100%;
  height: 100vh;
  background: black;
  overflow-y: auto;
  overflow-x: hidden;
  scroll-snap-type: y mandatory;
  -webkit-overflow-scrolling: touch;
}

.slide {
  width: 100%;
  height: 100vh;
  background: black;
  scroll-snap-align: start;
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

.slide.show {
  opacity: 1;
}

.slide img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

/* ---------- HUD ---------- */
.hud {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 9999;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  font-size: 14px;
  color: #fff;
  user-select: none;
  pointer-events: none;
}

.hud .pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,0.55);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(6px);
}

.hud .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
}

.hud .hint {
  margin-top: 6px;
  font-size: 12px;
  opacity: 0.75;
  text-align: right;
}
</style>
</head>

<body>

<!-- HUD -->
<div class="hud">
  <div class="pill">
    <span class="dot" id="hudDot"></span>
    <span id="hudText">Playing</span>
  </div>
  <div class="hint" id="hudHint">Tap to pause • Scroll to browse</div>
</div>

<div class="slideshow" id="slideshow">
  <img src="Slide1.PNG">
  <img src="Slide2.PNG">
  <img src="Slide3.PNG">
  <img src="Slide4.PNG">
  <img src="Slide5.PNG">
  <img src="Slide6.PNG">
  <img src="IMG20251224123009.PNG">
  <img src="IMG20251220155230.PNG">
  <img src="IMG20251220155304.PNG">
</div>

<script>
(() => {
  const params = new URLSearchParams(location.search);

  const stillTime = parseFloat(params.get("time")) || 3;
  const fadeTime  = 1;
  const maxSlides = 500;

  const slideshow = document.getElementById("slideshow");

  // HUD
  const hudText = document.getElementById("hudText");
  const hudDot  = document.getElementById("hudDot");
  const hudHint = document.getElementById("hudHint");

  function setHud(paused, reason = "") {
    if (paused) {
      hudText.textContent = reason ? `Paused (${reason})` : "Paused";
      hudDot.style.color = "rgba(200,200,200,0.95)";
      hudHint.textContent = "Tap to play • Scroll to browse";
    } else {
      hudText.textContent = "Playing";
      hudDot.style.color = "rgba(120,255,160,0.95)";
      hudHint.textContent = "Tap to pause • Scroll to browse";
    }
  }

  /* ---------------------------
     IMAGE LIST
  ---------------------------- */
  const originalImgs = Array.from(slideshow.querySelectorAll("img"));

  const requestedCount = parseInt(params.get("count"), 10);
  const slideCount = Math.min(
    Math.max(requestedCount || originalImgs.length, 1),
    maxSlides
  );

  const imgs = originalImgs.slice(0, slideCount);
  originalImgs.slice(slideCount).forEach(img => img.remove());

  // sub1, sub2, ...
  for (let i = 1; i <= imgs.length; i++) {
    const sub = params.get(`sub${i}`);
    if (sub) imgs[i - 1].src = sub;
  }

  // start on specific image
  const startImage = params.get("n");
  if (startImage) {
    const idx = imgs.findIndex(img => img.getAttribute("src") === startImage);
    if (idx > -1) {
      imgs.slice(idx).concat(imgs.slice(0, idx))
        .forEach(img => slideshow.appendChild(img));
    }
  }

  const orderedImgs = Array.from(slideshow.querySelectorAll("img"));

  /* ---------------------------
     WRAP INTO SLIDES
  ---------------------------- */
  const slides = orderedImgs.map(img => {
    const wrap = document.createElement("div");
    wrap.className = "slide";
    img.parentNode.insertBefore(wrap, img);
    wrap.appendChild(img);
    return wrap;
  });

  let index = 0;
  let timer = null;
  let paused = false;
  let autoScrolling = false;
  let scrollDebounce = null;

  function showOnly(i) {
    slides.forEach((s, k) => s.classList.toggle("show", k === i));
  }

  function scrollToIndex(i, behavior = "smooth") {
    autoScrolling = true;
    slideshow.scrollTo({ top: slides[i].offsetTop, behavior });
    setTimeout(() => autoScrolling = false, 700);
  }

  function jumpToFirst() {
    autoScrolling = true;
    slideshow.scrollTo({ top: slides[0].offsetTop, behavior: "auto" });
    setTimeout(() => autoScrolling = false, 50);
  }

  function jumpToLast() {
    autoScrolling = true;
    slideshow.scrollTo({
      top: slides[slides.length - 1].offsetTop,
      behavior: "auto"
    });
    setTimeout(() => autoScrolling = false, 50);
  }

  function nextSlide() {
    index = (index + 1) % slides.length;
    showOnly(index);
    scrollToIndex(index);
  }

  function start() {
    stop();
    paused = false;
    setHud(false);
    timer = setInterval(nextSlide, (stillTime + fadeTime) * 1000);
  }

  function stop() {
    if (timer) clearInterval(timer);
    timer = null;
  }

  function togglePause(e) {
    if (e) e.preventDefault();
    paused ? start() : (paused = true, stop(), setHud(true));
  }

  function onScroll() {
    if (autoScrolling) return;

    const scrollTop = slideshow.scrollTop;
    const maxScroll = slideshow.scrollHeight - slideshow.clientHeight;

    // ---- infinite loop ----
    if (scrollTop >= maxScroll - 2) {
      index = 0;
      showOnly(index);
      jumpToFirst();
      return;
    }
    if (scrollTop <= 2) {
      index = slides.length - 1;
      showOnly(index);
      jumpToLast();
      return;
    }

    // user scroll pauses autoplay
    if (!paused) {
      paused = true;
      stop();
      setHud(true, "scroll");
    }

    clearTimeout(scrollDebounce);
    scrollDebounce = setTimeout(() => {
      const pos = scrollTop + window.innerHeight / 2;
      let best = 0, bestDist = Infinity;

      slides.forEach((s, i) => {
        const mid = s.offsetTop + s.offsetHeight / 2;
        const d = Math.abs(mid - pos);
        if (d < bestDist) {
          bestDist = d;
          best = i;
        }
      });

      index = best;
      showOnly(index);
    }, 120);
  }

  // INIT
  showOnly(0);
  slideshow.scrollTo({ top: 0, behavior: "auto" });
  start();

  slideshow.addEventListener("click", togglePause);
  slideshow.addEventListener("touchstart", togglePause, { passive: false });
  slideshow.addEventListener("scroll", onScroll, { passive: true });
})();
</script>

</body>
</html>
